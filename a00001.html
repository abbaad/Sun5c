<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>LUFA Library - Sun Type 5c Keyboard Adapter: Adapter Hardware</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript">
$(document).ready(initResizable);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<script type="text/javascript">
function hasClass(ele,cls) {
  return ele.className.match(new RegExp('(\\s|^)'+cls+'(\\s|$)'));
}

function addClass(ele,cls) {
  if (!this.hasClass(ele,cls)) ele.className += " "+cls;
}

function removeClass(ele,cls) {
  if (hasClass(ele,cls)) {
    var reg = new RegExp('(\\s|^)'+cls+'(\\s|$)');
    ele.className=ele.className.replace(reg,' ');
  }
}

function toggleVisibility(linkObj) {
 var base = linkObj.getAttribute('id');
 var summary = document.getElementById(base + '-summary');
 var content = document.getElementById(base + '-content');
 var trigger = document.getElementById(base + '-trigger');
 if ( hasClass(linkObj,'closed') ) {
   summary.style.display = 'none';
   content.style.display = 'block';
   trigger.src = 'open.png';
   removeClass(linkObj,'closed');
   addClass(linkObj,'opened');
 } else if ( hasClass(linkObj,'opened') ) {
   summary.style.display = 'block';
   content.style.display = 'none';
   trigger.src = 'closed.png';
   removeClass(linkObj,'opened');
   addClass(linkObj,'closed');
 }
 return false;
}
</script>
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">LUFA Library - Sun Type 5c Keyboard Adapter</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('a00001.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">Adapter Hardware </div>  </div>
</div>
<div class="contents">
<div class="textblock"><p>There are many options in chosing an AVR platform which speaks USB, but there are only a few requirements: it must have a UART and it must have enough space.</p>
<p>As for the space issue, the code for this project has fewer lines than the USB-serial converter (which can fit into less than 4K), so a good target size is less than 4K (excluding EEPROM). Basically any USB AVR will work, including the lower Series 2 chips.</p>
<p>The keyboard and the chip may be bus-powered (the keyboard works at 5VDC), with an estimated total maximum current of 200mA (the keyboard should draw no more than 150mA). A crystal should be used to create a stable clock for the PLL of the USB clock as well as for the UART. A good choice is 16MHz.</p>
<p>The above requirements are met by a variety of pre-soldered development boards. This project was built and tested on the <a href="http://www.sparkfun.com/products/10277">SparkFun ATMEGA8U2 Breakout Board</a>. Other boards might be cheaper or better suited (for example the <a href="http://www.pjrc.com/teensy/">Teensy USB</a> or the <a href="http://www.minimususb.com/">Minimus</a> both happen to be cheaper and have chips larger than the 8K offered from SparkFun). The SparkFun board is preprogrammed with a flip-compliant DFU bootloader as well as a USB-to-Serial converter (both from other projects in the LUFA tree). The bootloader takes up 4K, leaving 4K for the program (a smaller 2K bootloader may be used if the fuses are changed appropriately).</p>
<div class="image">
<img src="schem_small.png" alt="schem_small.png"/>
<div class="caption">
The hardware adapter (blue rectangle) can interface with any AVR with a UART</div></div>
<p> For the UART and the keyboard to understand each other, the send and receive signals should each be inverted. The easiest way to accomplish this is with dedicated inverter IC such as 7404N (although other solutions such as two RTL inverters will work as well). Along with a female 8-port Mini-DIN connector, the inverters make up all the hardware required in addition to the development board.</p>
<p>With the hardware ready, the keyboard can be tested using the USB-Serial converter which comes pre-flashed on the SparkFun board. The keyboard is particularly easy to test with linux. In addition to the USB-Serial driver, ensure that the drivers for <code>serport</code> and <code>sunkbd</code> are compiled either into the kernel or as modules. Also ensure that your system has the <code>inputattach</code> tool (available from the <a href="http://sourceforge.net/projects/linuxconsole/">Linux Console</a> project). Connect the keyboard to the adapter and plug the adapter into the system. The keyboard will beep with a power-on self-test, and USB-Serial converter driver should create a <code>char</code> device (probably called <code>/dev/ttyACM0</code> or <code>/dev/ttyUSB0</code>). With appropriate privileges, the following command (replacing the name of the device as appropriate) </p>
<div class="fragment"><pre class="fragment">inputattach --sunkbd /dev/ttyACM0
</pre></div><p> should allow the <code>sunkbd</code> driver to access the serial device. The keyboard should now be working correctly for testing purposes.</p>
<p>The native serial driver has a few features which the current HID code lacks. In particular, the Macro key works, and the driver honors the keyboard beep and keyboard click settings. In fact, for a permanent solution, the following udev rule should help automatically load the driver. </p>
<div class="fragment"><pre class="fragment">ACTION==<span class="stringliteral">&quot;add&quot;</span>, SUBSYSTEM==<span class="stringliteral">&quot;tty&quot;</span>, ATTRS{Product}==<span class="stringliteral">&quot;SparkFun USBtoSerial&quot;</span>, SYMLINK+=<span class="stringliteral">&quot;sunkbd&quot;</span>, RUN+=<span class="stringliteral">&quot;/usr/bin/inputattach --daemon --sunkbd /dev/sunkbd&quot;</span>
</pre></div><p> (Of course the product string may be altered.)</p>
<p>The solution above, although adequate for testing the keyboard, has its pitfalls. Most obvious is that the solution will only work in linux (and even then, it will only work once udev has loaded). This makes the keyboard useless in the BIOS, the boot menu, or recovery mode.</p>
<div class="image">
<img src="board.jpg" alt="board.jpg"/>
<div class="caption">
The hardware adapter with case open for easy access to reset button</div></div>
 </div></div>
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="main.html">Sun Type 5c Keyboard Adapter</a>      </li>
      <li class="footer">Generated by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.4 </li>
    </ul>
  </div>

</body>
</html>
